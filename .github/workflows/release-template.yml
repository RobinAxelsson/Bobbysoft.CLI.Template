name: Release

on: push
permissions:
  contents: read

jobs:
  release:
    runs-on: windows-latest
    if: contains(github.event.head_commit.message, 'release')

    strategy:
      fail-fast: false

    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Setup NuGet CLI
      uses: nuget/setup-nuget@v2
      with:
        nuget-api-key: ${{ secrets.NUGET_API_KEY }}
        nuget-version: '5.x'
      
    - name: Pack
      run: nuget pack ./src/.nuspec

    - name: Publish to Nuget Gallery
      run: nuget push *.nupkg -Source https://api.nuget.org/v3/index.json