name: Release

on: push
permissions:
  contents: read

jobs:
  release:
    runs-on: windows-latest
    if: contains(github.event.head_commit.message, 'release')

    strategy:
      fail-fast: false

    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Show Directory
      run: ./build/ShowDir.ps1
      shell: pwsh

    - name: Setup NuGet CLI
      uses: nuget/setup-nuget@v2
      with:
        nuget-api-key: ${{ secrets.NUGET_API_KEY }}
        nuget-version: '5.x'
      
    - name: Pack
      run: nuget pack ./src/.nuspec

    - name: Show Directory
      run: ./build/ShowDir.ps1
      shell: pwsh

    - name: Publish to Nuget Gallery
      run: nuget push *.nupkg
    
    # - name: Pack
    #   run:  ./build/push.ps1
    #   shell: pwsh

    # - name: Show Directory
    #   run: ./build/ShowDir.ps1
    #   shell: pwsh

    # - name: Push to NuGet
    #   env:
    #     NUGET_URL: https://api.nuget.org/v3/index.json
    #     NUGET_API_KEY: ${{ secrets.NUGET_API_KEY }}
    #   run: ./build/Push.ps1
    #   shell: pwsh
